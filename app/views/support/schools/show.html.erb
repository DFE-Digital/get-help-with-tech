<% content_for :title, "#{@school.name} â€“ Support" %>
<%- content_for :before_content do %>
  <%= breadcrumbs([
    { 'Support home' => support_home_path },
    { t('page_titles.support_responsible_bodies') => support_responsible_bodies_path },
    { @school.responsible_body.name => support_responsible_body_path(@school.responsible_body) },
    @school.name,
  ]) %>
<% end %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <% if FeatureFlag.active?(:christmas_banner) || FeatureFlag.active?(:increased_allocations_banner) %>
      <%= render NotificationBanner.new(title: 'Important') do |banner| %>
        <% if FeatureFlag.active?(:increased_allocations_banner) && @school.increased_allocations_feature_flag? %>
          <p class="govuk-notification-banner__heading">
            <%= t('banners.increased_allocations.school.heading', count: @school&.std_device_allocation&.allocation) %>
          </p>
          <p class="govuk-body">
            <%= t('banners.increased_allocations.school.content') %>
          </p>
        <% end %>

        <% if FeatureFlag.active?(:christmas_banner) && FeatureFlag.active?(:increased_allocations_banner) && @school.increased_allocations_feature_flag? %>
          <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
        <% end %>

        <% if FeatureFlag.active?(:christmas_banner) %>
          <p class="govuk-notification-banner__heading"><%= t('banners.christmas.heading') %></p>
          <p class="govuk-body">
            <%= t('banners.christmas.content') %>
          </p>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">
      <span class="govuk-caption-xl"><%= @school.responsible_body.name %></span>
      <%= @school.name %>
    </h1>
  </div>
</div>

<%= render Support::SchoolDetailsSummaryListComponent.new(school: @school, viewer: current_user) %>

<h2 class="govuk-heading-l govuk-!-margin-top-9">Users</h2>

<% if policy(User).new? %>
  <%= govuk_button_link_to t('page_titles.new_school_user'), new_support_school_user_path(school_urn: @school.urn) %>
<% end %>

<% if @users.present? %>
  <% @users.each do |user| %>
    <div class="user">
      <h3 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-1"><%= user.full_name %></h3>
      <p class="govuk-body">
        <%= govuk_link_to "Edit user<span class=\"govuk-visually-hidden\"> #{user.full_name}</span>".html_safe, edit_support_school_user_path(school_urn: @school.urn, id: user.id) %>
      </p>
      <%= render Support::UserSummaryListComponent.new(user: user) %>
    </div>
  <% end %>
<% else %>
  <p class="govuk-body">None</p>
<% end %>

<h2 class="govuk-heading-l govuk-!-margin-top-9">Notifications sent</h2>
<% if @email_audits.present? %>
  <%= render Support::EmailAuditListComponent.new(@email_audits) %>
<% else %>
  <p class="govuk-body">None</p>
<% end %>
