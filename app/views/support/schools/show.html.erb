<% content_for :title, "#{@school.name} â€“ Support" %>
<%- content_for :before_content do %>
  <%= breadcrumbs([
    { 'Support home' => support_home_path },
    { t('page_titles.support_responsible_bodies') => support_responsible_bodies_path },
    { @school.responsible_body.name => support_responsible_body_path(@school.responsible_body) },
    @school.name,
  ]) %>
<% end %>

<%= render partial: 'shared/banners/school' %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">
      <span class="govuk-caption-xl"><%= @school.responsible_body.name %></span>
      <%= @school.name %>
    </h1>
  </div>
</div>

<% if @school.gias_status_closed? %>
  <div class="govuk-warning-text">
    <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
    <strong class="govuk-warning-text__text">
      <span class="govuk-warning-text__assistive">Warning</span>
      This <%= @school.institution_type %> has permanently closed
    </strong>
  </div>
<% end %>

<div class="govuk-tabs" data-module="govuk-tabs">
  <h2 class="govuk-tabs__title">
    Contents
  </h2>

  <ul class="govuk-tabs__list">
    <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
      <a class="govuk-tabs__tab" href="#overview">
        Overview
      </a>
    </li>
    <li class="govuk-tabs__list-item">
      <a class="govuk-tabs__tab" href="#users">
        Users
      </a>
    </li>
    <li class="govuk-tabs__list-item">
      <a class="govuk-tabs__tab" href="#notifications">
        Notifications
      </a>
    </li>
  </ul>

  <div class="govuk-tabs__panel" id="overview">
    <%= render Support::SchoolDetailsSummaryListComponent.new(school: @school, viewer: @current_user) %>

    <%- if @school.show_mno? && @school.extra_mobile_data_requests.present? %>
      <h2 class="govuk-heading-l govuk-!-margin-top-9">Mobile data requests</h2>
      <%= render Support::ExtraMobileDataRequestsSummaryListComponent.new(requests: @school.extra_mobile_data_requests) %>
    <%- end %>
  </div>

  <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="users">
    <% if policy(User).new? && @school.can_invite_users? %>
      <%= govuk_button_link_to 'Invite a new user', new_support_school_user_path(school_urn: @school.urn) %>
    <% end %>

    <% if @users.present? %>
      <% @users.each do |user| %>
        <div class="user">
          <h3 class="govuk-heading-m govuk-!-font-size-27 govuk-!-margin-bottom-2">
            <%= govuk_link_to user.full_name, support_user_path(user) %>
          </h3>
          <p class="govuk-body">
            <%= govuk_link_to "Edit user<span class=\"govuk-visually-hidden\"> #{user.full_name}</span>".html_safe, edit_support_user_path(user) %>
          </p>
          <%= render Support::UserPreviewSummaryListComponent.new(user: user) %>
        </div>
      <% end %>
    <% else %>
      <p class="govuk-body">None</p>
    <% end %>
  </div>

  <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="notifications">
    <% if @email_audits.present? %>
      <%= render Support::EmailAuditListComponent.new(@email_audits) %>
    <% else %>
      <p class="govuk-body">None</p>
    <% end %>
  </div>
</div>
